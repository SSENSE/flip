{"version":3,"file":"rollup-plugin-babel.cjs.js","sources":["../src/constants.js","../src/preflightCheck.js","../src/helperPlugin.js","../src/utils.js","../src/index.js"],"sourcesContent":["export const INLINE = {};\nexport const RUNTIME = {};\nexport const EXTERNAL = {};\n\n// NOTE: DO NOT REMOVE the null character `\\0` as it may be used by other plugins\n// e.g. https://github.com/rollup/rollup-plugin-node-resolve/blob/313a3e32f432f9eb18cc4c231cc7aac6df317a51/src/index.js#L74\nexport const HELPERS = '\\0rollupPluginBabelHelpers';\n","import { join } from 'path';\nimport { transform } from '@babel/core';\nimport { INLINE, RUNTIME, EXTERNAL } from './constants.js';\n\nconst MODULE_ERROR =\n\t'Rollup requires that your Babel configuration keeps ES6 module syntax intact. ' +\n\t'Unfortunately it looks like your configuration specifies a module transformer ' +\n\t'to replace ES6 modules with another module format. To continue you have to disable it.' +\n\t'\\n\\n' +\n\t'Most commonly it\\'s a CommonJS transform added by @babel/preset-env - ' +\n\t'in such case you should disable it by adding `modules: false` option to that preset ' +\n\t'(described in more detail here - https://github.com/rollup/rollup-plugin-babel#modules ).';\n\nconst UNEXPECTED_ERROR =\n\t'An unexpected situation arose. Please raise an issue at ' +\n\t'https://github.com/rollup/rollup-plugin-babel/issues. Thanks!';\n\nfunction fallbackClassTransform () {\n\treturn {\n\t\tvisitor: {\n\t\t\tClassDeclaration (path, state) {\n\t\t\t\tpath.replaceWith(path, state.file.addHelper('inherits'));\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport default function createPreflightCheck () {\n\tlet preflightCheckResults = {};\n\n\treturn ( ctx, options, dir ) => {\n\t\tif ( !preflightCheckResults[ dir ] ) {\n\t\t\tlet helpers;\n\n\t\t\toptions = Object.assign( {}, options );\n\t\t\tdelete options.only;\n\t\t\tdelete options.ignore;\n\n\t\t\toptions.filename = join( dir, 'x.js' );\n\n\t\t\tconst inputCode = 'class Foo extends Bar {};\\nexport default Foo;';\n\t\t\tlet check = transform( inputCode, options ).code;\n\n\t\t\tif ( ~check.indexOf('class ') ) {\n\t\t\t\toptions.plugins = (options.plugins || []).concat( fallbackClassTransform );\n\t\t\t\tcheck = transform( inputCode, options ).code;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t!~check.indexOf( 'export default' ) &&\n\t\t\t\t!~check.indexOf( 'export default Foo' ) &&\n\t\t\t\t!~check.indexOf( 'export { Foo as default }' )\n\t\t\t) {\n\t\t\t\tctx.error( MODULE_ERROR );\n\t\t\t}\n\n\t\t\tif ( check.match( /\\/helpers\\/(esm\\/)?inherits/ ) ) helpers = RUNTIME;\n\t\t\telse if ( ~check.indexOf( 'function _inherits' ) ) helpers = INLINE;\n\t\t\telse if ( ~check.indexOf( 'babelHelpers' ) ) helpers = EXTERNAL;\n\t\t\telse {\n\t\t\t\tctx.error( UNEXPECTED_ERROR );\n\t\t\t}\n\n\t\t\tpreflightCheckResults[ dir ] = helpers;\n\t\t}\n\n\t\treturn preflightCheckResults[ dir ];\n\t};\n}\n","import { HELPERS } from './constants.js';\nimport { addNamed } from '@babel/helper-module-imports';\n\nexport default function importHelperPlugin () {\n\treturn {\n\t\tpre (file) {\n\t\t\tconst cachedHelpers = {};\n\t\t\tfile.set('helperGenerator', name => {\n\t\t\t\tif (cachedHelpers[name]) {\n\t\t\t\t\treturn cachedHelpers[name];\n\t\t\t\t}\n\t\t\t\treturn (cachedHelpers[name] = addNamed(file.path, name, HELPERS));\n\t\t\t});\n\t\t},\n\t};\n}\n\n","let warned = {};\nexport function warnOnce ( ctx, msg ) {\n\tif ( warned[ msg ] ) return;\n\twarned[ msg ] = true;\n\tctx.warn( msg );\n}\n","import { dirname } from 'path';\nimport { buildExternalHelpers, transform } from '@babel/core';\nimport { createFilter } from 'rollup-pluginutils';\nimport createPreflightCheck from './preflightCheck.js';\nimport helperPlugin from './helperPlugin.js';\nimport { warnOnce } from './utils.js';\nimport { RUNTIME, EXTERNAL, HELPERS } from './constants.js';\n\nconst unpackOptions = ({\n\t// rollup uses sourcemap, babel uses sourceMaps\n\t// just normalize them here so people don't have to worry about it\n\tsourcemap = true,\n\tsourcemaps = true,\n\tsourceMap = true,\n\tsourceMaps = true,\n\t...rest\n} = {}) => ({\n\tsourceMaps: sourcemap && sourcemaps && sourceMap && sourceMaps,\n\t...rest\n});\n\nexport default function babel ( options ) {\n\tconst {\n\t\texclude,\n\t\texternalHelpers,\n\t\texternalHelpersWhitelist,\n\t\tinclude,\n\t\truntimeHelpers,\n\t\t...babelOptions\n\t} = unpackOptions(options);\n\n\tconst filter = createFilter( include, exclude );\n\tconst preflightCheck = createPreflightCheck();\n\n\treturn {\n\t\tname: 'babel',\n\n\t\tresolveId ( id ) {\n\t\t\tif ( id === HELPERS ) return id;\n\t\t},\n\n\t\tload ( id ) {\n\t\t\tif ( id !== HELPERS ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn buildExternalHelpers( externalHelpersWhitelist, 'module' );\n\t\t},\n\n\t\ttransform ( code, id ) {\n\t\t\tif ( !filter( id ) ) return null;\n\t\t\tif ( id === HELPERS ) return null;\n\n\t\t\tconst helpers = preflightCheck( this, babelOptions, dirname( id ) );\n\n\t\t\tif ( helpers === EXTERNAL && !externalHelpers ) {\n\t\t\t\twarnOnce( this, 'Using \"external-helpers\" plugin with rollup-plugin-babel is deprecated, as it now automatically deduplicates your Babel helpers.' );\n\t\t\t} else if ( helpers === RUNTIME && !runtimeHelpers ) {\n\t\t\t\tthis.error( 'Runtime helpers are not enabled. Either exclude the transform-runtime Babel plugin or pass the `runtimeHelpers: true` option. See https://github.com/rollup/rollup-plugin-babel#configuring-babel for more information' );\n\t\t\t}\n\n\t\t\tlet localOpts = Object.assign({ filename: id }, babelOptions);\n\n\t\t\tif ( helpers !== RUNTIME ) {\n\t\t\t\tlocalOpts = Object.assign({}, localOpts, { plugins: (localOpts.plugins || []).concat(helperPlugin) });\n\t\t\t}\n\n\t\t\tconst transformed = transform( code, localOpts );\n\n\t\t\tif (!transformed) {\n\t\t\t\treturn { code };\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tcode: transformed.code,\n\t\t\t\tmap: transformed.map\n\t\t\t};\n\t\t}\n\t};\n}\n"],"names":["const","path","let","join","transform","addNamed","createFilter","buildExternalHelpers","dirname","helperPlugin"],"mappings":"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"}